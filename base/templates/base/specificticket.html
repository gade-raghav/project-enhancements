{% extends 'base/main.html'%}
{% load static %}
{% block title %} Enhancements-{{project.project_title}} {% endblock %}
{% load humanize %}
{% load crispy_forms_tags%}

{% block content %}

<div class="container-lg px-3 p-2"> 
        <div>
            <div class="col-12 clearfix mt-2">
                <div class="d-flex float-right" style="margin-right: 10px;">
                    <div class="UnderlineNav-actions">
                        <form id="tickets-refresh" class="d-inline"  >
                          <input type="submit" onclick="window.location.reload();" value="Refresh" class="btn btn-sm mr-2" />
                        </form>            
                        <a class="btn btn-sm btn-primary mb-2 mt-2"  href="{% url 'tickets' %}">Return to tickets</a>
                      </div>

                </div>
            </div>
            <h1 class="" style="font-weight: normal;">{{ ticket.subject }} #{{ticket.tracking_id}}</h1>
            {% if ticket.ticket_status == "Open"%}
            <span class="State" style="width:100px; background-color: yellowgreen;">{{ticket.ticket_status}}</span>
            {% elif ticket.ticket_status == "Closed"%}
            <span class="State" style="width:100px; background-color: rgb(231, 28, 28);">{{ticket.ticket_status}}</span>
            {% elif ticket.ticket_status == "Resolved"%}
            <span class="State" style="width:100px; background-color: #3ebe63;">{{ticket.ticket_status}}</span>
            {% endif %}
            &nbsp;&nbsp;  <text style="color: gray;"> <strong>{{username}}</strong> opened this ticket on {{ticket.date_created}}</text>
            <hr>
            <div class="pl-8 pr-4 pb-8 pt-4">
                <div class="TimelineItem" >
                <div class="TimelineItem-badge" >
                    <strong>I</strong>
                  </div>
                <div class="timeline-comment-group TimelineItem-body my-0">
                  <div class="ml-n3 timeline-comment comment timeline-comment--caret">
                    <div class="timeline-comment-header clearfix">
                      <div class="pl-4">
                       <span class="text-gray-dark mr-1 css-truncate">
                            <strong class="css-truncate">
                              <span class="text-gray-dark css-truncate-target width-fit">
                                        <strong>{{username}}</strong>
                              </span>
                            </strong>
                          
                        </span>
                        commented on <text style="color: gray;">{{ticket.date_created}} </text>

                      </div>
            
                    </div>
                    <div class="Box ml-4" style="border-radius: 0;">
                        <p><div class="pl-3" id="content"><textarea>{{ ticket.bug_description}}</textarea></div></p>
                    </div>
                  </div>
                </div>
              </div>
                {% for comment in comments %}
                {% if comment.tracking.tracking_id == ticket.tracking_id %}
              <div class="TimelineItem" >
                <div class="TimelineItem-badge" >
                    <!-- octicon("flame") -->
                    <strong>C</strong>
                  </div>
                <div class="timeline-comment-group TimelineItem-body my-0">
                  <div class="ml-n3 timeline-comment comment timeline-comment--caret">
                    <div class="timeline-comment-header clearfix">
                      <div class="pl-4">
                       <span class="text-gray-dark mr-1 css-truncate">
                            <strong class="css-truncate">
                              <span class="text-gray-dark css-truncate-target width-fit">
                                  {% if comment.user == "AnonymousUser" %}
                                        <strong>{{username}}</strong>
                                  {% else %}  
                                        <strong>{{comment.user}}</strong>
                                  {% endif %}
                              </span>
                            </strong>
                          
                        </span>
                        commented on <text style="color: gray;">{{comment.date_created}} </text>

                      </div>
            
                    </div>
                    <div class="Box ml-4" style="border-radius: 0;">
                      <div class="pl-3 pt-2">
                          <p>
                              {{comment.comment}}
                          </p>
                     </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
              {% endfor %}
              {% if comments %}
              <hr class="m-0">
              {% endif %}
              <br>
              <div style="width: 400px; ">
              <form action="" autocomplete="off" method="POST">
                {% csrf_token %}
                {{ form.media}}
                {{ form|crispy }}
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-sm btn-danger "  href="{% url 'ticket' ticket.tracking_id%}">Cancel</a>
            </form>
              </div>
            </div>
        </div>
</div>

<script src="{% static 'mdeditor/js/jquery.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/editormd.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/marked.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/prettify.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/raphael.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/underscore.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/sequence-diagram.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/flowchart.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/jquery.flowchart.min.js' %}"></script>
<script>
  $(function () {
      // js 解析markdown
      editormd.markdownToHTML("content", {
          //htmlDecode      : "style,script,iframe",  // you can filter tags decode
          emoji           : true,
          taskList        : true,
          tex             : true,  // 默认不解析
          flowChart       : true,  // 默认不解析
          sequenceDiagram : true,  // 默认不解析
      });


      $(".reference-link").each(function (i,obj) {
        console.log(obj)
      })
  })
</script>
  <script src="/static/mdeditor/languages/en.js"></script>


{% endblock %}